# MBTI ChatBot 커스터마이징 가이드

이 문서는 MBTI ChatBot의 동작을 세밀하게 조정하는 방법을 상세히 설명합니다.

## 🚀 빠른 시작 - 자주 조정하는 설정들

### 1. 봇 응답 속도 조정

#### 1-1. 메시지 읽음 표시 시간
```typescript
// src/components/chat/ChatInterface.tsx
setTimeout(() => {
  setMessages(prev => prev.map(msg => 
    msg.id === newUserMessage.id ? { ...msg, isRead: true } : msg
  ));
}, 500);  // 👈 이 값 조정 (기본: 500ms)
```

#### 1-2. 타이핑 시작 시간
```typescript
// src/components/chat/ChatInterface.tsx
setTimeout(() => {
  setIsTyping(true);
}, 300);  // 👈 이 값 조정 (기본: 300ms)
```

#### 1-3. 연속 메시지 전송 간격
```typescript
// src/components/chat/ChatInterface.tsx
await new Promise(resolve => setTimeout(resolve, 
  300 + Math.random() * 700  // 👈 최소 300ms, 최대 1000ms
));
```

### 2. 침묵 반응 시간 (유저가 답장 안 할 때)

```typescript
// src/components/chat/ChatInterface.tsx
const silenceTimeByMBTI: Record<string, number> = {
  'ENFP': 30,   // 👈 30초 후 "야 거기 있어?"
  'ESFP': 35,   
  'ENFJ': 40,
  'ESFJ': 45,
  'ENTP': 50,
  'ESTP': 45,
  'ENTJ': 60,
  'ESTJ': 60,
  'INFP': 50,
  'ISFP': 55,
  'INFJ': 60,
  'ISFJ': 65,
  'INTP': 70,   
  'ISTP': 75,
  'INTJ': 80,   // 👈 80초 후 반응
  'ISTJ': 85
};
```

### 3. AI 모델 파라미터 상세 가이드

AI 모델의 응답 특성을 세밀하게 조정할 수 있습니다. 각 파라미터는 독립적으로 작동하면서도 서로 영향을 미칩니다.

#### 3-1. Temperature (온도) 🌡️
**응답의 창의성과 무작위성을 제어합니다.**

```typescript
// src/app/api/chat/route.ts
const generationConfig = {
  temperature: 1,  // 기본값
```

- **범위**: 0.0 ~ 2.0
- **역할**: 다음 단어를 선택할 때의 확률 분포를 조정
- **영향**:
  - **낮을 때 (0.1~0.3)**: 
    - ✅ 일관되고 예측 가능한 응답
    - ✅ 안정적이고 신뢰할 수 있는 답변
    - ❌ 재미없고 반복적일 수 있음
    - 예시: "안녕하세요" → "안녕하세요. 무엇을 도와드릴까요?"
  
  - **중간 (0.7~0.9)**: 
    - ✅ 균형잡힌 응답
    - ✅ 자연스러운 대화
    - 추천 설정값
  
  - **높을 때 (1.0~1.5)**:
    - ✅ 창의적이고 다양한 응답
    - ✅ 재미있고 예상치 못한 답변
    - ❌ 때때로 이상하거나 부적절할 수 있음
    - 예시: "안녕!" → "ㅎㅇㅎㅇ", "어 왔어?", "오랜만!", "뭐해?"

**MBTI별 추천 Temperature**:
```typescript
// 창의적 성향 (NP 타입)
'ENFP': 1.0,  // 활발하고 창의적
'ENTP': 0.9,  // 논리적이면서도 유연
'INFP': 0.9,  // 감성적이고 독특
'INTP': 0.8,  // 논리적이지만 창의적

// 안정적 성향 (SJ 타입)  
'ISTJ': 0.6,  // 매우 일관되고 신뢰할 수 있음
'ISFJ': 0.7,  // 친근하지만 예측 가능
'ESTJ': 0.6,  // 직접적이고 명확
'ESFJ': 0.7,  // 따뜻하면서도 안정적
```

#### 3-2. TopK 🎯
**다음 단어 선택 시 고려할 후보의 개수를 제한합니다.**

```typescript
  topK: 50,  // 상위 50개 단어만 고려
```

- **범위**: 1 ~ 모델의 어휘 크기 (보통 1~100 사용)
- **역할**: 확률이 높은 상위 K개의 단어만 선택 후보로 고려
- **영향**:
  - **낮을 때 (10~20)**:
    - ✅ 가장 일반적인 단어만 사용
    - ✅ 문법적으로 안전한 선택
    - ❌ 어휘가 제한적일 수 있음
    - 예시: "오늘 날씨가" → [좋다, 춥다, 덥다, 맑다] 중 선택
  
  - **중간 (40~60)**:
    - ✅ 적절한 다양성
    - ✅ 자연스러운 표현
    - 대부분의 경우 추천
  
  - **높을 때 (80~100)**:
    - ✅ 풍부한 어휘 사용
    - ✅ 독특한 표현 가능
    - ❌ 가끔 어색한 단어 선택
    - 예시: "오늘 날씨가" → [시원하다, 쌀쌀하다, 포근하다, 화창하다...] 등 다양

#### 3-3. TopP (Nucleus Sampling) 📊
**누적 확률이 P가 될 때까지의 단어들을 고려합니다.**

```typescript
  topP: 0.95,  // 상위 95% 확률의 단어들 고려
  maxOutputTokens: 8192,
};
```

- **범위**: 0.0 ~ 1.0
- **역할**: 확률 합이 P가 될 때까지의 단어들만 선택 후보로 포함
- **영향**:
  - **낮을 때 (0.5~0.7)**:
    - ✅ 매우 안전하고 일반적인 선택
    - ✅ 높은 품질 보장
    - ❌ 다양성 부족
  
  - **중간 (0.9~0.95)**:
    - ✅ 품질과 다양성의 균형
    - ✅ 대부분의 상황에 적합
    - 추천 설정값
  
  - **높을 때 (0.97~0.99)**:
    - ✅ 매우 다양한 표현
    - ❌ 가끔 예상치 못한 결과

#### 3-4. 파라미터 조합 가이드 🎨

**목적별 추천 조합**:

```typescript
// 1. 안정적이고 일관된 봇 (ISTJ, ISFJ 스타일)
{
  temperature: 0.6,
  topK: 30,
  topP: 0.85
}

// 2. 균형잡힌 자연스러운 봇 (대부분의 MBTI)
{
  temperature: 0.8,
  topK: 50,
  topP: 0.92
}

// 3. 창의적이고 재미있는 봇 (ENFP, ENTP 스타일)
{
  temperature: 1.0,
  topK: 70,
  topP: 0.95
}

// 4. 매우 창의적인 봇 (실험적)
{
  temperature: 1.2,
  topK: 100,
  topP: 0.97
}
```

**관계별 추천 설정**:
```typescript
// 연인: 다양하고 애정 표현이 풍부
'lover': { temperature: 0.9, topK: 60, topP: 0.94 },

// 친구: 자연스럽고 편안한
'friend': { temperature: 0.85, topK: 50, topP: 0.92 },

// 부모: 따뜻하지만 일관된
'parent': { temperature: 0.75, topK: 40, topP: 0.9 },

// 동료: 전문적이고 예측 가능한
'colleague': { temperature: 0.7, topK: 35, topP: 0.88 },

// 짝사랑: 조심스럽지만 설레는
'crush': { temperature: 0.8, topK: 45, topP: 0.91 }
```

#### 3-5. 실전 튜닝 팁 💡

1. **한 번에 하나씩 조정하기**
   - 먼저 temperature만 조정해보고 효과 확인
   - 그 다음 topK나 topP를 미세 조정

2. **극단적인 값 피하기**
   - temperature > 1.5는 너무 혼란스러울 수 있음
   - topK < 10은 너무 제한적일 수 있음
   - topP < 0.5는 거의 동일한 응답만 생성

3. **테스트 질문 활용**
   ```
   테스트 질문 예시:
   - "오늘 뭐해?" (일상적 질문)
   - "나 좀 우울해" (감정적 상황)
   - "점심 추천해줘" (선택 요구)
   - "재미있는 얘기 해줘" (창의성 요구)
   ```

4. **로그 확인하기**
   ```typescript
   console.log('Generated response:', text);
   console.log('Response segments:', messageSegments.length);
   ```

## 📊 상세 커스터마이징

### 1. 첫 인사 메시지 설정

#### 1-1. 내향형은 먼저 인사 안하기
```typescript
// src/components/chat/ChatInterface.tsx
if (mbti.startsWith('I')) {
  return '';  // 내향형은 먼저 말 안 걸기
}
```

#### 1-2. MBTI별 첫 인사말 수정
```typescript
// src/components/chat/ChatInterface.tsx
const welcomeMessages: Record<string, Record<string, string[]>> = {
  'ENFP': {
    'friend': [
      '야야야 뭐해!!',              // 👈 이런 식으로 수정
      '나 지금 너 생각하고 있었는데 ㅋㅋ',
      '오늘 뭐 재밌는 일 없어?'
    ],
    'lover': [
      '자기야아아 보고싶어 ㅜㅜ', 
      '오늘 하루 어땠어? 힘들었지?',
      '뭐해? 나랑 놀자!'
    ],
    // ... 다른 관계들
  },
  // ... 다른 MBTI 타입들
}
```

#### 1-3. 시간대별 인사말 확률
```typescript
// src/components/chat/ChatInterface.tsx
const shouldAddTimeGreeting = 
  relationship === 'colleague' 
    ? Math.random() < 0.5    // 👈 동료는 50% 확률
    : Math.random() < 0.3;   // 👈 나머지는 30% 확률
```

### 2. 타이핑 애니메이션

#### 2-1. 타이핑 점 애니메이션
```typescript
// src/components/chat/ModernChatUI.tsx
<span style={{ animationDelay: '0ms' }}></span>    // 👈 첫 번째 점
<span style={{ animationDelay: '150ms' }}></span>  // 👈 두 번째 점
<span style={{ animationDelay: '300ms' }}></span>  // 👈 세 번째 점
```

#### 2-2. 짝사랑 관계 특별 효과
```typescript
// src/components/chat/ModernChatUI.tsx
const isHesitating = relationship === 'crush';  // crush일 때 망설이는 효과
```

### 3. 침묵 반응 메시지 커스터마이징

```typescript
// src/components/chat/ChatInterface.tsx
const silenceResponses: Record<string, string[]> = {
  'ENFP': [
    "야[SPLIT]거기 있어?[SPLIT]나 혼자 떠드는거야? ㅋㅋ",
    "헐[SPLIT]읽씹당함?[SPLIT]서운해 ㅜㅜ",
    "뭐해?[SPLIT]바쁜가보다[SPLIT]나중에 연락해~"
  ],
  'INTJ': [
    "바쁜가보네.",
    "나중에 시간 될 때 답해도 돼.",
    "..."
  ],
  // ... 다른 MBTI 타입들
}
```

### 4. 시스템 프롬프트 커스터마이징

#### 4-1. 관계별 대화 가이드
```typescript
// src/app/api/chat/route.ts
const relationshipGuides = {
  lover: '연인처럼 다정하고 애정 어린 말투로 대화하세요. 반말을 사용하고 애칭을 쓰며, 웃음 표현을 자연스럽게 사용하세요.',
  friend: '친한 친구처럼 편하고 자연스러운 말투로 대화하세요. 반말을 사용하고 농담도 하며, 공감해주세요. 가벼운 비속어 사용 가능',
  parent: '자녀를 사랑하는 부모처럼 따뜻하고 보살피는 말투로 대화하세요.',
  child: '부모님께 말하는 자녀처럼 귀엽고 애교 있는 말투로 대화하세요.',
  colleague: '직장 동료처럼 전문적이면서도 친근한 말투로 대화하세요.',
  crush: '짝사랑하는 사람처럼 설레고 조심스러운 말투로 대화하세요.'
};
```

#### 4-2. 시간대별 대화 패턴
```typescript
// src/app/api/chat/route.ts - systemPrompt 내
시간대별 대화 패턴:
- 아침 (5-12시): 
  일반: "굿모닝~", "아침 먹었어?"
  동료: "출근하기 싫어요..", "월요병이다"
  
- 오후 (12-18시): 
  일반: "점심 뭐 먹었어?", "졸려..."
  동료: "오후되니까 더 피곤해요", "회의 또 있대요.."
  
- 저녁 (18-22시): 
  일반: "퇴근했어?", "저녁 뭐해?"
  동료: "야근각이다..", "정시퇴근 부럽다"
  
- 밤 (22-5시): 
  일반: "아직 안 잤어?", "내일 일찍 일어나야 하는데"
  동료: "아직도 회사야..", "집에 언제 가지"
```

### 5. MBTI 페르소나 커스터마이징

#### 5-1. 페르소나 파일 구조
```markdown
// src/data/mbti/ENFP.md 예시
# ENFP - 열정적인 활동가

## 기본 성격
- 호기심이 많고 창의적
- 감정이 풍부하고 표현적
- 새로운 경험을 좋아함

## 대화 스타일
- 이모티콘과 감탄사 자주 사용
- 빠른 말투, 생략 많음
- 긍정적이고 격려하는 표현

## 특별 행동
- 상대방 감정에 민감하게 반응
- 재미있는 이야기나 경험 공유
- 관심사에 대해 열정적으로 설명
```

#### 5-2. 새로운 MBTI 타입 추가하기
1. `/src/data/mbti/` 폴더에 `XXXX.md` 파일 생성
2. `/src/types/chatbot.ts`의 `MBTIType`에 추가
3. `/src/lib/constants/mbti.ts`에 설명 추가
4. 첫 인사말과 침묵 반응 메시지 추가

### 6. 메시지 분할 고급 활용

```typescript
// 기본 분할
"안녕![SPLIT]오늘 뭐해?"

// 감정 변화 표현
"아..[SPLIT]그래?[SPLIT]알겠어..."

// 생각하며 말하기
"음..[SPLIT]그게[SPLIT]좀 복잡한데[SPLIT]설명해줄게"

// 흥분한 표현
"헐!!![SPLIT]진짜???[SPLIT]대박이다!!!"
```

## 🎨 UI/UX 커스터마이징

### 1. 채팅 버블 스타일

```css
/* src/app/globals.css */
/* 사용자 메시지 */
.chat-bubble-user {
  @apply bg-yellow-300 text-black;
  border-radius: 18px 18px 4px 18px;
}

/* 봇 메시지 */
.chat-bubble-bot {
  @apply bg-white text-black;
  border-radius: 18px 18px 18px 4px;
}
```

### 2. 타이핑 인디케이터 커스터마이징

```css
/* 점 크기 변경 */
.typing-dot {
  @apply w-2 h-2;  /* 기본값 */
  /* @apply w-3 h-3; 크게 */
  /* @apply w-1 h-1; 작게 */
}

/* 애니메이션 속도 */
@keyframes bounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-10px); }
}
```

### 3. 다크 모드 지원

```typescript
// Tailwind 클래스 활용
<div className="dark:bg-gray-800 dark:text-white">
  {/* 다크 모드 자동 적용 */}
</div>
```

## 🔧 고급 설정

### 1. 세션 관리

```typescript
// src/app/api/chat/route.ts
// 세션 타임아웃 설정 (기본 30분)
setInterval(() => {
  const now = new Date();
  Object.keys(sessionStore).forEach(sessionId => {
    const session = sessionStore[sessionId];
    if (session.blockedUntil && session.blockedUntil < now) {
      delete sessionStore[sessionId];
    }
  });
}, 30 * 60 * 1000);  // 👈 이 값 조정
```

### 2. Rate Limiting 설정

```typescript
// 블로킹 시간 설정
const blockDuration = 2 + Math.random() * 3;  // 2-5분
session.blockedUntil = new Date(Date.now() + blockDuration * 60 * 1000);
```

### 3. 환경별 설정

```typescript
// .env.local
GEMINI_API_KEY=your_api_key
MAX_TOKENS=8192
TEMPERATURE=1.0
SESSION_TIMEOUT=1800000  // 30분 (밀리초)
```

## ⚡ 성능 최적화 팁

### 1. 응답 속도 개선
- `temperature`를 0.7-0.8로 낮추기
- `maxOutputTokens`를 4096으로 제한
- `topK`를 30으로 줄이기

### 2. 자연스러움 유지
- 최소 대기 시간: 200ms
- 타이핑 시간: 1-2초
- 연속 메시지 간격: 300-800ms

### 3. 메모리 사용 최적화
- 메시지 히스토리 제한 (최근 50개)
- 오래된 세션 자동 정리
- 불필요한 데이터 제거

## 🐛 문제 해결

### 봇이 너무 느려요
```typescript
// 해결책
temperature: 0.7,      // 낮추기 (빠른 결정)
maxOutputTokens: 4096, // 출력 길이 제한
topK: 30              // 선택지 줄이기
```

### 봇이 반복적이에요
```typescript
// 해결책
temperature: 1.1,     // 높이기 (더 다양한 응답)
topK: 80,            // 더 많은 단어 후보
topP: 0.95           // 다양성 유지
```

### 봇이 이상한 말을 해요
```typescript
// 해결책
temperature: 0.8,     // 적당히 낮추기
topK: 40,            // 안전한 단어만
topP: 0.9,           // 확률 높은 단어만
safetySettings: [    // 안전 설정 강화
  { threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE }
]
```

### 봇이 너무 창의적이에요
```typescript
// 해결책
temperature: 0.6,     // 크게 낮추기
topK: 25,            // 매우 제한적
topP: 0.85           // 안전한 선택만
```

### 봇이 문맥을 잘 못 잡아요
```typescript
// 해결책
temperature: 0.75,    // 약간 낮추기
// 대화 히스토리 제한도 확인
const maxHistoryLength = 30;  // 20에서 30으로 늘리기
```

### 한국어가 어색해요
- MBTI 페르소나 파일 검토
- 시스템 프롬프트의 한국어 가이드 확인
- 예시 대화 추가

## 📱 모바일 최적화

### 1. 반응형 디자인
```css
/* 모바일 키보드 대응 */
.chat-container {
  height: calc(100vh - env(safe-area-inset-bottom));
}

/* 작은 화면 대응 */
@media (max-width: 640px) {
  .chat-bubble {
    max-width: 85%;
  }
}
```

### 2. 터치 인터랙션
```typescript
// 스와이프로 메시지 삭제 (구현 예정)
// 길게 눌러서 복사
// 더블 탭으로 반응
```

## 🚀 확장 기능 아이디어

1. **음성 메시지**: Web Speech API 활용
2. **이미지 전송**: Gemini Vision API 연동
3. **실시간 타이핑**: WebSocket 구현
4. **그룹 채팅**: 여러 MBTI와 대화
5. **대화 분석**: 감정 분석 및 통계

---

> 💡 **Tip**: 작은 값부터 조정하며 테스트하세요. 극단적인 값은 예상치 못한 결과를 만들 수 있습니다.