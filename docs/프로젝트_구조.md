# MBTI ChatBot 프로젝트 구조 상세 설명

## 📁 전체 디렉토리 구조

```
mbtichatbot/
├── src/                        # 소스 코드 루트
├── public/                     # 정적 파일
├── docs/                       # 프로젝트 문서
├── scripts/                    # 유틸리티 스크립트
├── attached_assets/            # 첨부 자료
├── data/                       # 데이터 파일
├── node_modules/               # npm 패키지
├── .next/                      # Next.js 빌드 출력
├── package.json                # 프로젝트 설정
├── tsconfig.json              # TypeScript 설정
├── tailwind.config.ts         # Tailwind CSS 설정
├── next.config.js             # Next.js 설정
├── drizzle.config.ts          # Drizzle ORM 설정
├── postcss.config.js          # PostCSS 설정
├── components.json            # shadcn/ui 설정
├── vercel.json                # Vercel 배포 설정
└── README.md                  # 프로젝트 README
```

## 🗂 핵심 디렉토리 상세

### `/src` - 소스 코드

#### `/src/app` - Next.js App Router
```
app/
├── api/                       # API 라우트
│   └── chat/                 # 채팅 API
│       ├── route.ts         # POST /api/chat - Gemini AI 통신
│       └── test/            # 테스트 엔드포인트
│           └── route.ts     # GET /api/chat/test - API 키 검증
├── chat/                     # 채팅 페이지
│   └── page.tsx             # /chat 라우트
├── setup/                    # 설정 페이지
│   └── page.tsx             # /setup 라우트
├── globals.css              # 전역 스타일
├── layout.tsx               # 루트 레이아웃
└── page.tsx                 # 홈페이지 (/)
```

#### `/src/components` - React 컴포넌트
```
components/
├── chat/                     # 채팅 관련 컴포넌트
│   ├── ChatBubble.tsx       # 채팅 말풍선
│   ├── ChatHeader.tsx       # 채팅방 헤더
│   ├── ChatInput.tsx        # 메시지 입력창
│   ├── ChatInterface.tsx    # 채팅 인터페이스 메인 (핵심 로직)
│   ├── KakaoChat.tsx        # 카카오톡 스타일 UI
│   └── ModernChatUI.tsx     # 모던 채팅 UI
├── setup/                    # 설정 관련 컴포넌트
│   ├── GenderSelector.tsx   # 성별 선택
│   ├── MBTISelector.tsx     # MBTI 유형 선택
│   ├── RelationshipSelector.tsx # 관계 선택
│   └── SetupWizard.tsx      # 설정 마법사 메인
└── README.md                # 컴포넌트 문서
```

#### `/src/data` - 정적 데이터
```
data/
└── mbti/                     # MBTI 페르소나 데이터
    ├── INTJ.md              # INTJ 유형 특성
    ├── INTP.md              # INTP 유형 특성
    ├── ENTJ.md              # ENTJ 유형 특성
    ├── ENTP.md              # ENTP 유형 특성
    ├── INFJ.md              # INFJ 유형 특성
    ├── INFP.md              # INFP 유형 특성
    ├── ENFJ.md              # ENFJ 유형 특성
    ├── ENFP.md              # ENFP 유형 특성
    ├── ISTJ.md              # ISTJ 유형 특성
    ├── ISFJ.md              # ISFJ 유형 특성
    ├── ESTJ.md              # ESTJ 유형 특성
    ├── ESFJ.md              # ESFJ 유형 특성
    ├── ISTP.md              # ISTP 유형 특성
    ├── ISFP.md              # ISFP 유형 특성
    ├── ESTP.md              # ESTP 유형 특성
    └── ESFP.md              # ESFP 유형 특성
```

#### `/src/lib` - 라이브러리 및 유틸리티
```
lib/
├── constants/                # 상수 정의
│   ├── mbti.ts              # MBTI 관련 상수
│   └── README.md            # 상수 문서
├── db/                      # 데이터베이스
│   └── schema.ts            # DB 스키마 정의
└── utils/                   # 유틸리티 함수
    └── message.ts           # 메시지 처리 함수
```

#### `/src/types` - TypeScript 타입 정의
```
types/
├── chatbot.ts               # 챗봇 관련 타입
├── session.ts               # 세션 관련 타입
└── README.md                # 타입 문서
```

### `/public` - 정적 파일
```
public/
├── images/                  # 이미지 파일
├── robots.txt              # 검색 엔진 크롤러 설정
├── site.webmanifest        # PWA 매니페스트
└── sitemap.xml             # 사이트맵
```

### `/docs` - 프로젝트 문서
```
docs/
├── CLAUDE.md               # Claude AI 컨텍스트
├── README.md               # 문서 디렉토리 설명
├── 프로젝트_README.md      # 프로젝트 개요
├── 프로젝트_구조.md        # 프로젝트 구조 (현재 파일)
├── 프로젝트_아키텍처.md    # 시스템 아키텍처
├── 커스터마이징_가이드.md  # 커스터마이징 방법
├── MCP_설치_가이드.md      # MCP 설치 가이드
├── 윈도우 MCP 설치.txt     # Windows MCP 설치
├── gemini.md               # Gemini AI 정보
└── 커맨드.txt              # 유용한 명령어
```

## 🔧 주요 파일별 기능 설명

### 1. `/src/components/chat/ChatInterface.tsx` - 채팅의 핵심

#### 주요 상태 변수
```typescript
const [messages, setMessages] = useState<ChatMessage[]>([])  // 대화 메시지 배열
const [isTyping, setIsTyping] = useState(false)             // 봇 타이핑 중 여부
const silenceTimerRef = useRef<NodeJS.Timeout | null>(null) // 침묵 타이머
const lastBotMessageTimeRef = useRef<Date | null>(null)     // 마지막 봇 메시지 시간
```

#### 핵심 함수들

##### `generateWelcomeMessage()` - 첫 인사 메시지 생성
- MBTI별 맞춤 인사말
- 시간대별 인사 (30% 확률, 동료는 50%)
- 관계별 적절한 말투

##### `startSilenceTimer()` - 유저 무응답시 챗봇 반응
- MBTI별 대기 시간 차별화 (30초~85초)
- 외향형은 빠르게, 내향형은 천천히 반응
- 자연스러운 타이핑 시뮬레이션

##### `handleSendMessage()` - 메시지 전송 처리
- 읽음 처리 시간 (0.5초)
- 타이핑 시작 딜레이 (0.3초)
- 연속 메시지 간격 (0.3~1초)

### 2. `/src/app/api/chat/route.ts` - Gemini API 통신

#### 주요 설정값

##### AI 모델 설정
```typescript
const generationConfig = {
  temperature: 1,        // 창의성 (0~1, 높을수록 창의적)
  topK: 50,             // 상위 K개 토큰 선택
  topP: 0.95,           // 누적 확률 임계값
  maxOutputTokens: 8192, // 최대 출력 토큰 수
}
```

##### 세션 관리
- 메모리 기반 세션 스토어
- 30분마다 자동 정리
- Rate limiting 구현

##### 관계별 대화 가이드
- 연인: 다정하고 애정 어린 말투
- 친구: 편하고 자연스러운 말투 (가벼운 비속어 허용)
- 부모: 따뜻하고 보살피는 말투
- 자식: 귀엽고 애교 있는 말투
- 동료: 전문적이면서도 친근한 말투
- 짝사랑: 설레고 조심스러운 말투

### 3. 타입 정의 (`/src/types/chatbot.ts`)

```typescript
// MBTI 타입 (16가지)
export type MBTIType = 'INTJ' | 'INTP' | 'ENTJ' | 'ENTP' | ...

// 성별
export type Gender = 'male' | 'female'

// 관계
export type Relationship = 'parent' | 'child' | 'lover' | 'crush' | 'friend' | 'colleague'

// 챗봇 설정
export interface ChatbotConfig {
  mbti: MBTIType
  gender: Gender
  relationship: Relationship
  name?: string
}
```

## 📝 주요 파일 설명

### 설정 파일

| 파일명 | 용도 |
|--------|------|
| `package.json` | 프로젝트 의존성 및 스크립트 |
| `tsconfig.json` | TypeScript 컴파일러 설정 |
| `next.config.js` | Next.js 프레임워크 설정 |
| `tailwind.config.ts` | Tailwind CSS 설정 |
| `drizzle.config.ts` | Drizzle ORM 데이터베이스 설정 |
| `components.json` | shadcn/ui 컴포넌트 설정 |
| `vercel.json` | Vercel 배포 플랫폼 설정 |

### 환경 변수

`.env.local` 파일에 저장되는 환경 변수:
- `GEMINI_API_KEY`: Google Gemini AI API 키
- `DATABASE_URL`: PostgreSQL 연결 URL
- `GOOGLE_TRANSLATE_API_KEY`: 번역 API 키 (선택)

## 🔍 코드 네이밍 규칙

### 파일/폴더명
- 컴포넌트: PascalCase (예: `ChatBubble.tsx`)
- 유틸리티: camelCase (예: `message.ts`)
- 폴더: kebab-case 또는 lowercase (예: `chat/`)

### 변수/함수명
- 변수: camelCase (예: `chatMessage`)
- 상수: UPPER_SNAKE_CASE (예: `MAX_MESSAGE_LENGTH`)
- 타입/인터페이스: PascalCase (예: `ChatMessage`)

## ⚙️ 채팅 동작 커스터마이징 가이드

### 빠른 조정 가이드

| 조정하고 싶은 것 | 파일 | 설명 | 기본값 |
|-----------------|------|------|--------|
| 봇 응답 속도 | ChatInterface.tsx | 메시지 읽은 후 타이핑 시작 | 300ms |
| 연속 메시지 간격 | ChatInterface.tsx | 분할 메시지 사이 간격 | 300-1000ms |
| 침묵 대기 시간 | ChatInterface.tsx | 무응답시 챗봇 반응 시간 | 30-85초 |
| AI 창의성 | route.ts | temperature 값 | 1.0 |
| 최대 응답 길이 | route.ts | maxOutputTokens | 8192 토큰 |
| 시간대별 인사말 확률 | ChatInterface.tsx | 시간 인사 출현 확률 | 30% (동료 50%) |

### 주의사항

1. **temperature 값**: 너무 높으면 (>1.5) 비일관적, 너무 낮으면 (<0.5) 반복적
2. **대기 시간**: 너무 짧으면 부자연스럽고, 너무 길면 사용자 이탈
3. **메시지 분할**: 너무 많이 분할하면 스팸처럼 보일 수 있음
4. **시스템 프롬프트**: 너무 복잡하면 AI가 혼란스러워할 수 있음

## 🚀 개발 워크플로우

1. **기능 개발 위치**
   - 새로운 페이지: `/src/app` 디렉토리
   - 새로운 컴포넌트: `/src/components` 디렉토리
   - API 엔드포인트: `/src/app/api` 디렉토리

2. **타입 정의**
   - 관련 타입은 `/src/types`에 정의
   - 컴포넌트별 타입은 해당 컴포넌트 파일에 정의

3. **스타일링**
   - Tailwind CSS 클래스 사용
   - 전역 스타일: `/src/app/globals.css`
   - 컴포넌트별 스타일: CSS Modules 또는 Tailwind

4. **데이터 관리**
   - MBTI 페르소나: `/src/data/mbti` 마크다운 파일
   - API 응답: TypeScript 타입으로 관리

## 📦 빌드 출력

```
빌드 후 생성되는 디렉토리:
├── .next/                   # Next.js 빌드 출력
├── dist/                    # TypeScript 컴파일 출력
└── node_modules/            # npm 패키지
```

## 🔧 유지보수 가이드

### 새로운 MBTI 타입 추가
1. `/src/data/mbti/` 폴더에 마크다운 파일 생성
2. `/src/types/chatbot.ts`의 `MBTIType` 타입에 추가
3. `/src/lib/constants/mbti.ts`에 상수 추가

### 새로운 관계 타입 추가
1. `/src/types/chatbot.ts`의 `Relationship` 타입에 추가
2. `/src/app/api/chat/route.ts`의 `relationshipGuides`에 가이드 추가
3. 관련 컴포넌트 UI 업데이트

### 새로운 페이지 추가
1. `/src/app/` 디렉토리에 폴더 생성
2. `page.tsx` 파일 생성
3. 필요시 `layout.tsx` 추가

---

> 📌 **Note**: 이 문서는 프로젝트 구조가 변경될 때마다 업데이트되어야 합니다.